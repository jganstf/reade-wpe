<?php

$fields = get_fields();

$icons = array(
    'default' => '<svg class="icon-clipboard" width="32" height="39" viewBox="0 0 32 39" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M8.82533 4.40225C9.54147 2.18069 11.6259 0.573486 14.0856 0.573486H17.9144C20.3741 0.573486 22.4585 2.18069 23.1747 4.40225H25.5719C28.6237 4.40225 31.0977 6.87621 31.0977 9.928V32.9006C31.0977 35.9524 28.6237 38.4263 25.5719 38.4263H6.4281C3.37631 38.4263 0.902344 35.9524 0.902344 32.9006V9.928C0.902344 6.87621 3.37631 4.40225 6.4281 4.40225H8.82533ZM8.82533 7.79624H6.4281C5.25076 7.79624 4.29633 8.75066 4.29633 9.928V32.9006C4.29633 34.0779 5.25076 35.0323 6.4281 35.0323H25.5719C26.7492 35.0323 27.7037 34.0779 27.7037 32.9006V9.928C27.7037 8.75066 26.7492 7.79624 25.5719 7.79624H23.1747C22.4585 10.0178 20.3741 11.625 17.9144 11.625H14.0856C11.6259 11.625 9.54147 10.0178 8.82533 7.79624ZM14.0856 3.96747C12.9083 3.96747 11.9539 4.9219 11.9539 6.09924C11.9539 7.27658 12.9083 8.23101 14.0856 8.23101H17.9144C19.0917 8.23101 20.0461 7.27658 20.0461 6.09924C20.0461 4.9219 19.0917 3.96747 17.9144 3.96747H14.0856ZM8.55986 19.4999C8.55986 18.5627 9.31963 17.8029 10.2569 17.8029H10.276C11.2132 17.8029 11.973 18.5627 11.973 19.4999C11.973 20.4371 11.2132 21.1969 10.276 21.1969H10.2569C9.31963 21.1969 8.55986 20.4371 8.55986 19.4999ZM14.303 19.4999C14.303 18.5627 15.0628 17.8029 16 17.8029H21.7431C22.6804 17.8029 23.4401 18.5627 23.4401 19.4999C23.4401 20.4371 22.6804 21.1969 21.7431 21.1969H16C15.0628 21.1969 14.303 20.4371 14.303 19.4999ZM8.55986 27.1574C8.55986 26.2202 9.31963 25.4604 10.2569 25.4604H10.276C11.2132 25.4604 11.973 26.2202 11.973 27.1574C11.973 28.0947 11.2132 28.8544 10.276 28.8544H10.2569C9.31963 28.8544 8.55986 28.0947 8.55986 27.1574ZM14.303 27.1574C14.303 26.2202 15.0628 25.4604 16 25.4604H21.7431C22.6804 25.4604 23.4401 26.2202 23.4401 27.1574C23.4401 28.0947 22.6804 28.8544 21.7431 28.8544H16C15.0628 28.8544 14.303 28.0947 14.303 27.1574Z" fill="#61C5DD"/>
    </svg>',
    
    'clipboard' => '<svg class="icon-clipboard" width="32" height="39" viewBox="0 0 32 39" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M8.82533 4.40225C9.54147 2.18069 11.6259 0.573486 14.0856 0.573486H17.9144C20.3741 0.573486 22.4585 2.18069 23.1747 4.40225H25.5719C28.6237 4.40225 31.0977 6.87621 31.0977 9.928V32.9006C31.0977 35.9524 28.6237 38.4263 25.5719 38.4263H6.4281C3.37631 38.4263 0.902344 35.9524 0.902344 32.9006V9.928C0.902344 6.87621 3.37631 4.40225 6.4281 4.40225H8.82533ZM8.82533 7.79624H6.4281C5.25076 7.79624 4.29633 8.75066 4.29633 9.928V32.9006C4.29633 34.0779 5.25076 35.0323 6.4281 35.0323H25.5719C26.7492 35.0323 27.7037 34.0779 27.7037 32.9006V9.928C27.7037 8.75066 26.7492 7.79624 25.5719 7.79624H23.1747C22.4585 10.0178 20.3741 11.625 17.9144 11.625H14.0856C11.6259 11.625 9.54147 10.0178 8.82533 7.79624ZM14.0856 3.96747C12.9083 3.96747 11.9539 4.9219 11.9539 6.09924C11.9539 7.27658 12.9083 8.23101 14.0856 8.23101H17.9144C19.0917 8.23101 20.0461 7.27658 20.0461 6.09924C20.0461 4.9219 19.0917 3.96747 17.9144 3.96747H14.0856ZM8.55986 19.4999C8.55986 18.5627 9.31963 17.8029 10.2569 17.8029H10.276C11.2132 17.8029 11.973 18.5627 11.973 19.4999C11.973 20.4371 11.2132 21.1969 10.276 21.1969H10.2569C9.31963 21.1969 8.55986 20.4371 8.55986 19.4999ZM14.303 19.4999C14.303 18.5627 15.0628 17.8029 16 17.8029H21.7431C22.6804 17.8029 23.4401 18.5627 23.4401 19.4999C23.4401 20.4371 22.6804 21.1969 21.7431 21.1969H16C15.0628 21.1969 14.303 20.4371 14.303 19.4999ZM8.55986 27.1574C8.55986 26.2202 9.31963 25.4604 10.2569 25.4604H10.276C11.2132 25.4604 11.973 26.2202 11.973 27.1574C11.973 28.0947 11.2132 28.8544 10.276 28.8544H10.2569C9.31963 28.8544 8.55986 28.0947 8.55986 27.1574ZM14.303 27.1574C14.303 26.2202 15.0628 25.4604 16 25.4604H21.7431C22.6804 25.4604 23.4401 26.2202 23.4401 27.1574C23.4401 28.0947 22.6804 28.8544 21.7431 28.8544H16C15.0628 28.8544 14.303 28.0947 14.303 27.1574Z" fill="#61C5DD"/>
    </svg>'
);

if (!empty($fields['categories_to_show'])) {
    ?>
    <div class="ms-group">
        <?php

        foreach ($fields['categories_to_show'] AS $cts) {

            if ($term = get_term_by('id', $cts, 'ms_documents_categories')) {
                if ($term->count > 0) {
                    ?>
                    <div class="ms-group-cat">
                        <h2 class="ms-group-cat-title"><?php echo $term->name; ?></h2>
                        <?php

                        if (!empty($term->description)) {
                            ?><p class="ms-group-cat-desc"><?php echo $term->description; ?></p>
                            <?php
                        }

                        ?>

                        <hr>

                        <div class="ms-group-cat-posts">
                            <?php

                            $mscatposts = get_posts(array(
                                'post_type' => 'ms-documents',
                                'numberposts' => -1,
                                'status' => 'publish',
                                'orderby' => 'date',
                                'order' => 'DESC',
                                'tax_query' => array(
                                     array(
                                         'taxonomy' => 'ms_documents_categories',
                                         'field' => 'term_id',
                                         'terms' => $term->term_id,
                                     ),
                                 )
                            ));
                            
                            if ($mscatposts) {
                                foreach ($mscatposts AS $mscatpost) {
                                    $pfields = get_fields($mscatpost->ID);
                                    ?>
                                    <div class="ms-group-cat-post">
                                        <div class="ms-group-cat-post-icon">
                                            <?php
                                            // sample $pfields content
                                            // Array
                                            //     (
                                            //         [url] => https://yahoo.com
                                            //         [open_in_new_tab] => 1
                                            //         [icon] => clipboard
                                            //     )

                                            if (!empty($pfields['icon']) && isset($icons[$pfields['icon']])) {
                                                echo $icons[$pfields['icon']];
                                            } else {
                                                echo $icons['default'];
                                            }

                                            ?>
                                        </div>
                                        <a class="btn-blue-dark-blue" href="<?php echo !empty($pfields['url']) ? $pfields['url'] : '#'; ?>" <?php if ($pfields['open_in_new_tab']) { echo 'target="_blank"'; } ?>><?php echo $mscatpost->post_title; ?></a>
                                    </div>
                                    <?php
                                }
                            }

                            ?>
                        </div>
                    </div>
                    <?php
                }
            }
        }
        ?>
    </div>
    <?php
}